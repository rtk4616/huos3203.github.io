{"title":"高德地图API使用","slug":"iOS/高德地图API使用","date":"2018-05-30T14:40:56.000Z","updated":"2018-05-30T18:42:20.000Z","comments":true,"path":"api/articles/iOS/高德地图API使用.json","excerpt":null,"covers":null,"content":"<link rel=\"stylesheet\" href=\"/owl.css\"><link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"/assets/css/APlayer.min.css\"><script src=\"/assets/js/APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><script class=\"meting-secondary-script-marker\" src=\"/assets/js/Meting.min.js\"></script><h2 id=\"引入头文件\"><a href=\"#引入头文件\" class=\"headerlink\" title=\"引入头文件\"></a>引入头文件</h2><figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">&lt;AMapFoundationKit/AMapFoundationKit.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">&lt;AMapLocationKit/AMapLocationKit.h&gt;</span></span></span><br></pre></td></tr></table></figure>\n<h2 id=\"调用方法\"><a href=\"#调用方法\" class=\"headerlink\" title=\"调用方法\"></a>调用方法</h2><figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">NSString</span> *strKey = <span class=\"string\">@\"2d8a96d668576584acebf2bab0ba0c08\"</span>;<span class=\"comment\">//默认值</span></span><br><span class=\"line\"><span class=\"comment\">//配置里面取值</span></span><br><span class=\"line\"><span class=\"built_in\">NSString</span> *strBundleKey = [[<span class=\"built_in\">NSBundle</span> mainBundle] infoDictionary][<span class=\"string\">@\"IOSPostionkey\"</span>];</span><br><span class=\"line\"><span class=\"keyword\">if</span> (strBundleKey) &#123;</span><br><span class=\"line\">    strKey = strBundleKey;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">[AMapServices sharedServices].apiKey = strKey;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 带逆地理信息的一次定位（返回坐标和地址信息）</span></span><br><span class=\"line\"><span class=\"keyword\">self</span>.GaodelocationManager = [[AMapLocationManager alloc] init];</span><br><span class=\"line\">[<span class=\"keyword\">self</span>.GaodelocationManager setDesiredAccuracy:kCLLocationAccuracyHundredMeters];</span><br><span class=\"line\"><span class=\"comment\">//   定位超时时间，最低2s，此处设置为2s</span></span><br><span class=\"line\"><span class=\"keyword\">self</span>.GaodelocationManager.locationTimeout =<span class=\"number\">10</span>;</span><br><span class=\"line\"><span class=\"comment\">//   逆地理请求超时时间，最低2s，此处设置为2s</span></span><br><span class=\"line\"><span class=\"keyword\">self</span>.GaodelocationManager.reGeocodeTimeout = <span class=\"number\">10</span>;</span><br><span class=\"line\"><span class=\"comment\">//设置不允许系统暂停定位</span></span><br><span class=\"line\">[<span class=\"keyword\">self</span>.GaodelocationManager setPausesLocationUpdatesAutomatically:<span class=\"literal\">NO</span>];</span><br><span class=\"line\"><span class=\"comment\">//    //设置允许在后台定位</span></span><br><span class=\"line\"><span class=\"comment\">//    [locationManager setAllowsBackgroundLocationUpdates:YES];</span></span><br><span class=\"line\"><span class=\"comment\">//设置允许连续定位逆地理</span></span><br><span class=\"line\">[<span class=\"keyword\">self</span>.GaodelocationManager setLocatingWithReGeocode:<span class=\"literal\">YES</span>];</span><br><span class=\"line\"><span class=\"comment\">//    [locationManager setDelegate:self];</span></span><br><span class=\"line\"><span class=\"comment\">// [self.locationManager startUpdatingLocation];</span></span><br><span class=\"line\"><span class=\"comment\">//    // 带逆地理（返回坐标和地址信息）。将下面代码中的 YES 改成 NO ，则不会返回地址信息。</span></span><br><span class=\"line\">[<span class=\"keyword\">self</span>.GaodelocationManager requestLocationWithReGeocode:<span class=\"literal\">YES</span> completionBlock:^(<span class=\"built_in\">CLLocation</span> *gaodeLocation, AMapLocationReGeocode *regeocode, <span class=\"built_in\">NSError</span> *error) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (gaodeLocation==<span class=\"literal\">nil</span>) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"高德没有返回地理位置,使用苹果官方定位经纬度\"</span>);</span><br><span class=\"line\">        [<span class=\"keyword\">self</span> GetGISInfoByByLocationWithjingdu:jingdu AndWeidu:weidu];</span><br><span class=\"line\">        <span class=\"keyword\">return</span> ;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (error)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"locError:&#123;%ld - %@&#125;;\"</span>, (<span class=\"keyword\">long</span>)error.code, error.localizedDescription);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (error.code == AMapLocationErrorLocateFailed)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"AMapLocationErrorLocateFailed高德没有返回地理位置,使用苹果官方定位经纬度\"</span>);</span><br><span class=\"line\">            [<span class=\"keyword\">self</span> GetGISInfoByByLocationWithjingdu:jingdu AndWeidu:weidu];</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"使用高德location:%@\"</span>, gaodeLocation);</span><br><span class=\"line\">    <span class=\"built_in\">NSString</span> * gaodeWeidu =  [<span class=\"built_in\">NSString</span> stringWithFormat:<span class=\"string\">@\"%.9f\"</span>,gaodeLocation.coordinate.latitude];</span><br><span class=\"line\">    <span class=\"built_in\">NSString</span> * gaodeJingdu =  [<span class=\"built_in\">NSString</span> stringWithFormat:<span class=\"string\">@\"%.9f\"</span>,gaodeLocation.coordinate.longitude];</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (regeocode)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@\"reGeocode:%@\"</span>, regeocode);</span><br><span class=\"line\">        <span class=\"keyword\">self</span>.theRealAdress = regeocode.formattedAddress;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    [<span class=\"keyword\">self</span> GetGISInfoByByLocationWithjingdu:gaodeJingdu AndWeidu:gaodeWeidu];</span><br><span class=\"line\">&#125;];</span><br></pre></td></tr></table></figure>\n","categories":[{"name":"iOS","path":"api/categories/iOS.json"}],"tags":[]}