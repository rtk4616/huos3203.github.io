{"title":"小米路由常用操作","slug":"小米路由常用操作","date":"2015-09-25T23:59:16.000Z","updated":"2018-03-28T07:42:14.000Z","comments":true,"path":"api/articles/小米路由常用操作.json","excerpt":"常用命令ssh登录局域网登录:ssh [user@]hostname [command] 例如：ssh root@192.168.31.1  或  远程登录：ssh root@222.35.145.28 -p 2195回车输入密码**修改密码：**root@xiaoqiang:~#passwd   回车输入新密码回车再次输入新密码远程拷贝数据scp Desktop/ar71xx/* root@192.168.31.1:/userdisk/myWorkspace/ar71xx每次重启路由获取IP:vi /etc/rc.localsh /etc/getIP.sh//启动后，等待20秒，然后，获取当前时间作为文件名称<br>//使用ifconfig 获取路由器的ip信息<br>//使用 | grep 通道，和grep正则来过滤出，wan口的ip所在行<br>// &gt; 使用重定向，将过滤的ip行，写入路由硬盘/userdisk/data/my/ip目录中<br>//通过小米路由手机客户端，找到该txt文件，并下载到手机sd卡中<br>//查看该文件，既有路由重启后的当前IP  ","covers":null,"content":"<script src=\"/assets/js/APlayer.min.js\"> </script><h4 id=\"常用命令\"><a href=\"#常用命令\" class=\"headerlink\" title=\"常用命令\"></a>常用命令</h4><ol>\n<li><p>ssh登录</p>\n<pre><code>局域网登录:\nssh [user@]hostname [command]\n 例如：ssh root@192.168.31.1  或  远程登录：ssh root@222.35.145.28 -p 2195\n回车\n输入密码\n\n**修改密码：**\nroot@xiaoqiang:~#passwd   \n回车\n输入新密码\n回车\n再次输入新密码\n</code></pre></li>\n<li><p>远程拷贝数据</p>\n<pre><code>scp Desktop/ar71xx/* root@192.168.31.1:/userdisk/myWorkspace/ar71xx\n</code></pre></li>\n<li><p>每次重启路由获取IP:</p>\n<pre><code>vi /etc/rc.local\nsh /etc/getIP.sh\n</code></pre><p>//启动后，等待20秒，然后，获取当前时间作为文件名称<br>//使用ifconfig 获取路由器的ip信息<br>//使用 | grep 通道，和grep正则来过滤出，wan口的ip所在行<br>// &gt; 使用重定向，将过滤的ip行，写入路由硬盘/userdisk/data/my/ip目录中<br>//通过小米路由手机客户端，找到该txt文件，并下载到手机sd卡中<br>//查看该文件，既有路由重启后的当前IP  </p>\n<a id=\"more\"></a>\n<p> 详见getIP.sh</p>\n<pre><code>#!/bin/sh\nsleep 20\ncurrent_date=`date +%Y_%m_%d`\ncurrent_time=`date +%H_%M_%S`\necho $current_date\necho $current_time\n#local_ip=`ifconfig |grep &apos;[0-9]\\{1,3\\}.*P-t-P&apos;`\nlocal_ip=`ifconfig | grep P-t-P`\necho $local_ip &gt; /userdisk/data/my/ip/$current_date:$current_time.txt\n</code></pre></li>\n<li><p>修改防火墙设置<strong>/etc/config</strong>目录下的<strong>dropbear</strong>和<strong>firewall</strong>  </p>\n<pre><code>cd /etc/config  //把备份文件内容覆盖新文件即可\n1.cat dropbear.bak &gt; dropbear  \n    增加如下内容：\n    config dropbear\n    option PasswordAuth &apos;on&apos;\n    option RootPasswordAuth &apos;on&apos;\n    option Interface &apos;wan&apos;\n    option Port &apos;2195&apos;\n2.保存文件修改后，再重启dropbear服务，一次输入下面两行命令：\n    /etc/init.d/dropbear reload\n    /etc/init.d/dropbear restart\n1.cat firewall.bak &gt; firewall\n    增加如下内容： \n    config rule\n    option name &apos;Allow-wan-ssh&apos;\n    option src &apos;wan&apos;\n    option proto &apos;tcp&apos;\n    option dest_port &apos;2195&apos;\n    option target &apos;ACCEPT&apos;\n2.保存文档的更改后，重启防火墙服务，依次输入以下两条命令：\n    /etc/init.d/firewall reload\n    /etc/init.d/firewall restart\n</code></pre></li>\n</ol>\n<p>5.由于铁通机制，分配的独立iP，并不能被外网访问</p>\n<h4 id=\"ssh登录数据库-转\"><a href=\"#ssh登录数据库-转\" class=\"headerlink\" title=\"ssh登录数据库    转\"></a>ssh登录数据库    <a href=\"http://bbs.xiaomi.cn/thread-10339070-1-1.html\" target=\"_blank\" rel=\"noopener\">转</a></h4><p>先确保能访问<a href=\"http://192.168.31.1:8088/phpinfo.php\" target=\"_blank\" rel=\"noopener\">LLMP搭建的个人网站地址</a>  </p>\n<p>修复教程：  </p>\n<ol>\n<li>登录路由： <code>ssh root@192.168.31.1</code>  mm:admin</li>\n<li>执行命令：<code>/userdisk/data/lamp.sh fix</code>  </li>\n<li><p>再次访问个人网站地址。  <a href=\"http://192.168.31.1:8088/phpinfo.php\" target=\"_blank\" rel=\"noopener\">LLMP搭建的个人网站地址</a> 。 </p>\n<pre><code>1./userdisk/data/lamp.sh  (安装本插件，一键开启llmp，具体安装过程可见前面的安装步骤）       \n2./userdisk/data/lamp.sh a（卸载本插件，恢复安装前，注：卸载本插件时路由器会自动重启一次，自动断网几分钟）\n3./userdisk/data/lamp.sh fix（升级小米路由器固件后，能瞬间恢复自己搭建的网站功能，另外，如果在极特殊的情况的情况下，本功能无效，可使用如下方法恢复自建网站的功能：先尝试重新安装本插件，如果提示不能重复安装，可先卸载本插件，再重新安装本插件，并按说明3对数据库执行修改密码命令，改回原来的密码，原来自己搭建网站就可恢复使用）\n4./userdisk/data/lamp.sh help  (插件用法的帮助信息）\n</code></pre></li>\n</ol>\n<p>登录数据库：<code>ssh mysql@192.168.31.1 -p 2222</code></p>\n<p>正确日志：</p>\n<pre><code>AdmindeMacBook-Air:~ admin$ ssh mysql@192.168.31.1 -p 2222\nThe authenticity of host &apos;[192.168.31.1]:2222 ([192.168.31.1]:2222)&apos; can&apos;t be established.\nRSA key fingerprint is SHA256:bLH9smUb7sD9CZLWCsT6t9YqPy2jciznepkscFNd59M.\nAre you sure you want to continue connecting (yes/no)? yes\nWarning: Permanently added &apos;[192.168.31.1]:2222&apos; (RSA) to the list of known hosts.\nmysql@192.168.31.1&apos;s password:admin\n\nBusyBox v1.19.4 (2015-05-08 18:41:26 CST) built-in shell (ash)\nEnter &apos;help&apos; for a list of built-in commands.\n\n    ~ $\n</code></pre><p>错误日志：<br>需要修改本地的ssh配置。</p>\n<ol>\n<li>vi /Users/admin/.ssh/known_hosts文件</li>\n<li>删除包含[192.168.31.1]:2222的一行内容。</li>\n<li><p>重新登录数据库：ssh mysql@192.168.31.1 -p 2222。  </p>\n<pre><code>AdmindeMacBook-Air:~ admin$ ssh mysql@192.168.31.1 -p 2222\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\n@    WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED!     @\n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\nIT IS POSSIBLE THAT SOMEONE IS DOING SOMETHING NASTY!\nSomeone could be eavesdropping on you right now (man-in-the-middle attack)!\nIt is also possible that a host key has just been changed.\nThe fingerprint for the RSA key sent by the remote host is\nSHA256:bLH9smUb7sD9CZLWCsT6t9YqPy2jciznepkscFNd59M.\nPlease contact your system administrator.\nAdd correct host key in /Users/admin/.ssh/known_hosts to get rid of this message.\nOffending RSA key in /Users/admin/.ssh/known_hosts:10\nRSA host key for [192.168.31.1]:2222 has changed and you have requested strict checking.\nHost key verification failed.\n</code></pre></li>\n</ol>\n<h5 id=\"客户端MySQLWorkbench无法连接LLMP个人网站的MySql数据库\"><a href=\"#客户端MySQLWorkbench无法连接LLMP个人网站的MySql数据库\" class=\"headerlink\" title=\"客户端MySQLWorkbench无法连接LLMP个人网站的MySql数据库\"></a>客户端MySQLWorkbench无法连接LLMP个人网站的MySql数据库</h5>","categories":[{"name":"shell","path":"api/categories/shell.json"},{"name":"路由器","path":"api/categories/路由器.json"}],"tags":[{"name":"小米路由","path":"api/tags/小米路由.json"},{"name":"SSH","path":"api/tags/SSH.json"},{"name":"协议","path":"api/tags/协议.json"}]}