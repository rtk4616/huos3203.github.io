{"title":"instrument之Zombie工具","slug":"调试/instrument之Zombie工具","date":"2014-07-01T19:54:02.000Z","updated":"2018-03-28T07:42:14.000Z","comments":true,"path":"api/articles/调试/instrument之Zombie工具.json","excerpt":"Zombie:针对僵尸对象导致应用程序崩溃，即已经deallocated的对象，它们的retainCount计数器已经为0，通过正常的手段是无法在debug中跟踪和观察到的。如果你开启了 Zombie Enabled ，则当 Zombie 问题出现时，控制台会输出 Zombie 对象的地址，且程序会在此处产生断点：-[CALayer retainCount]: message sent to deallocated instance &lt;memoryaddress&gt;","covers":["/images/templateOfTraceDcument.jpg","/images/ErrCodeline.jpg","/images/Errorcode.png"],"content":"<link rel=\"stylesheet\" href=\"/owl.css\"><script src=\"/assets/js/APlayer.min.js\"> </script><p>Zombie:针对<strong>僵尸对象</strong>导致应用程序崩溃，即已经<code>deallocated</code>的对象，它们的<code>retainCount</code>计数器已经为0，通过正常的手段是无法在<code>debug</code>中跟踪和观察到的。</p>\n<p>如果你开启了 <code>Zombie Enabled</code> ，则当 Zombie 问题出现时，控制台会输出 Zombie 对象的地址，且程序会在此处产生断点：</p>\n<pre><code>-[CALayer retainCount]: message sent to deallocated instance &lt;memoryaddress&gt;\n</code></pre><a id=\"more\"></a>\n<p>虽然可以看到内存地址，知道是某个指针导致了 <code>Zombie</code> 引用，但对于解决问题却毫无帮助，因为仍不知道该地址到底是哪个对象？原因很显然，既然该对象已经<code>deallocated</code>，就无法再从内存中找回它来。虽然可以以对象的形式打印这个指针：</p>\n<pre><code>（GDB）po &lt;内存地址&gt;\n</code></pre><p>仍然会得到一个 <strong><code>message sent to deallocated instance</code></strong> 的错误消息。</p>\n<p>可以在 <code>Instrument</code> 用 <code>Zombie</code> 模板，来观察到这些 <code>Zombie</code> 对象。</p>\n<blockquote>\n<p>提示：只能在模拟器中使用 Zombie 模板，对于在设备中运行的程序， 你只能手动找出<code>Zombie</code>对象，<code>Zombie</code>模板对物理设备无效。</p>\n</blockquote>\n<p>使用操作如下：<br>点击 Xcode 的 Project –&gt; Profile 菜单。在 Instrument 的“模板选择窗口”中，选择“iOSSimulator”下面的 Zombie 模板。<br><img src=\"/images/templateOfTraceDcument.jpg\" alt=\"image\"><br>在模拟器中调试程序，如果 Zombie 问题出现，程序将崩溃，同时 Instrument 会弹出一个“Zombie 消息报告”，同时程序将在此处中断，如下图所示。<br><img src=\"/images/ZombieMsgAlert.jpg\" alt=\"image\"></p>\n<p>点击地址 (0x158b3c00) 右边的箭头，将列出该 Zombie 对象曾经发生过的 retain/release 动作。</p>\n<p>从列表中找到 retain count 在变为 -1 之前的那行,打开 View -&gt; Extended detail，将显示导致了过渡释放的代码调用：<br><img src=\"/images/ErrCodeline.jpg\" alt=\"image\"></p>\n<p>双击这句代码，将在源文件中高亮显示该语句：</p>\n<p><img src=\"/images/Errorcode.png\" alt=\"image\"><br>现在，知道问题出在哪里了吧？</p>\n","categories":[{"name":"xcode","path":"api/categories/xcode.json"},{"name":"instrument","path":"api/categories/instrument.json"}],"tags":[{"name":"工具","path":"api/tags/工具.json"},{"name":"Storyboard","path":"api/tags/Storyboard.json"}]}